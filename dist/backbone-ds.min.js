!function(e){var n={},r={},t={};n.defineResource=function(e){var n,i=["idAttribute","name","collection","model"];if(i.forEach(function(n){if(!e.hasOwnProperty(n)||!e[n])throw new Error(n+" must be specified when defining a resource")}),n=e.name,r[n])throw new Error(n+" resource has already been defined!");return r[n]=e,t[n]||(t[n]=new e.collection),this},n.createInstance=function(e){return new r[e].model},n.inject=function(e,n){var r=t[e];return r.add(n)},n.get=function(e,n){var i,o,c=r[e].idAttribute,u={};return o=t[e],o&&(u[c]=n,i=o.findWhere(u))?i:null},n.getAll=function(e){return t[e]},n.ejectAll=function(e){var n=t[e];n&&n.reset()},n.find=function(e,t){var i={},o=r[e].idAttribute,c=this.get("person",t),u=$.Deferred();return c?(u.resolve(c),u.promise()):(i[o]=t,c=new r[e].model(i),c.fetch().then(function(){return n.inject(e,c),c},function(){throw new Error("error fetching model: "+t)}))},n.findAll=function(e){var r=t[e];return r.fetch().then(function(t){return n.inject(e,t),r},function(){throw new Error("error fetching collection: "+e)})},n.where=function(e,n){var i=t[e],o=r[e].collection,c=new o,u=i.where(n);return c.add(u),c},n.reset=function(){return t={},r={},this},e.DS=n,"function"==typeof define&&define.amd&&define(["backbone"],function(){return n})}(window);