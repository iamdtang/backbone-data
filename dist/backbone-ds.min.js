!function(e){function n(e,n){var t,r=u[e].idAttribute;a[e]=a[e]||{},_.isArray(n)?n.forEach(function(n){var t=n[r];a[e][t]=!0}):(t=n[r],a[e][t]=!0)}function t(e,n){return a[e]?a[e][n]:!1}function r(e){return u[e].collection?!1:!0}function i(e){var n=new $.Deferred,t=this.get(e);return t.fetch().then(function(){n.resolve(t)}),n.promise()}function o(e,n){var r,i,o,f={},d=$.Deferred();return o=this.get(e,n),r=u[e].idAttribute,o?t(e,n)?o.fetch().then(function(){return delete a[e][n],o}):(d.resolve(o),d.promise()):(f[r]=n,i=new u[e].model(f),i.fetch().then(function(){return c.inject(e,i),i},function(){throw new Error("error fetching model: "+n)}))}var c={},u={},f={},a={},d={};c.defineResource=function(e){if(!e.hasOwnProperty("name")||!e.name)throw new Error("name must be specified when defining a resource");if(!e.hasOwnProperty("model")||!_.isFunction(e.model))throw new Error("model must be specified when defining a resource");if((!e.hasOwnProperty("idAttribute")||!e.idAttribute)&&e.collection)throw new Error("idAttribute must be specified when defining a resource");if(u[e.name])throw new Error(e.name+" resource has already been defined!");return u[e.name]=e,f[e.name]||(f[e.name]=e.collection?new e.collection:new e.model),this},c.createInstance=function(e){return new u[e].model},c.inject=function(e,t,r){var i,o;return f[e]instanceof Backbone.Collection?(r=_.extend({incomplete:!1},r),i=f[e],r.incomplete&&n(e,t),i.add(t)):(o=f[e],o.set(t))},c.get=function(e,n){var t,i,o,c={};return r(e)?f[e]:(o=u[e].idAttribute,i=f[e],i&&(c[o]=n,t=i.findWhere(c))?t:null)},c.getAll=function(e){return f[e]},c.ejectAll=function(e){var n=f[e];n&&n.reset()},c.find=function(e,n){return r(e)?i.call(this,e):o.call(this,e,n)},c.findAll=function(e,n){var t=f[e],r=$.Deferred();return d.hasOwnProperty(e)?(r.resolve(t),r.promise()):t.fetch().then(function(r){return c.inject(e,r,n),d[e]="completed",t},function(){throw new Error("error fetching collection: "+e)})},c.where=function(e,n){var t=f[e],r=u[e].collection,i=new r,o=t.where(n);return i.add(o),i},c.filter=function(e,n){var t=f[e],r=u[e].collection,i=new r,o=t.filter(n);return i.add(o),i},c.update=function(e,n,t){var r=this.get(e,n);return r.set(t),r.save().then(function(){return r})},c.create=function(e,n){u[e].idAttribute;return n.save().then(function(){return f[e].add(n),n})},c.destroy=function(e,n){var t=this.get(e,n);return t.destroy()},c.reset=function(){return f={},u={},a={},d={},this},e.DS=c,"function"==typeof define&&define.amd&&define(["backbone"],function(){return c})}(window);