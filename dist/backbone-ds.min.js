!function(e){function n(e,n){var t,r=i[e].idAttribute;c[e]=c[e]||{},_.isArray(n)?n.forEach(function(n){var t=n[r];c[e][t]=!0}):(t=n[r],c[e][t]=!0)}function t(e,n){return c[e]?c[e][n]:!1}var r={},i={},o={},c={};r.defineResource=function(e){var n,t=["idAttribute","name","collection","model"];if(t.forEach(function(n){if(!e.hasOwnProperty(n)||!e[n])throw new Error(n+" must be specified when defining a resource")}),n=e.name,i[n])throw new Error(n+" resource has already been defined!");return i[n]=e,o[n]||(o[n]=new e.collection),this},r.createInstance=function(e){return new i[e].model},r.inject=function(e,t,r){var i;return r=_.extend({incomplete:!1},r),i=o[e],r.incomplete&&n(e,t),i.add(t)},r.get=function(e,n){var t,r,c=i[e].idAttribute,u={};return r=o[e],r&&(u[c]=n,t=r.findWhere(u))?t:null},r.getAll=function(e){return o[e]},r.ejectAll=function(e){var n=o[e];n&&n.reset()},r.find=function(e,n){var o,u={},f=i[e].idAttribute,d=this.get(e,n),a=$.Deferred();return d?t(e,n)?d.fetch().then(function(){return delete c[e][n],d}):(a.resolve(d),a.promise()):(u[f]=n,o=new i[e].model(u),o.fetch().then(function(){return r.inject(e,o),o},function(){throw new Error("error fetching model: "+n)}))},r.findAll=function(e){var n=o[e];return n.fetch().then(function(t){return r.inject(e,t),n},function(){throw new Error("error fetching collection: "+e)})},r.where=function(e,n){var t=o[e],r=i[e].collection,c=new r,u=t.where(n);return c.add(u),c},r.filter=function(e,n){var t=o[e],r=i[e].collection,c=new r,u=t.filter(n);return c.add(u),c},r.create=function(e,n){i[e].idAttribute;return n.save().then(function(){return o[e].add(n),n})},r.destroy=function(e,n){var t=this.get(e,n);return t.destroy()},r.reset=function(){return o={},i={},c={},this},e.DS=r,"function"==typeof define&&define.amd&&define(["backbone"],function(){return r})}(window);