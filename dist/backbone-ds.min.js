!function(e){function n(e,n){var r,t=i[e].idAttribute;c[e]=c[e]||{},_.isArray(n)?n.forEach(function(n){var r=n[t];c[e][r]=!0}):(r=n[t],c[e][r]=!0)}function r(e,n){return c[e]?c[e][n]:!1}var t={},i={},o={},c={};t.defineResource=function(e){var n,r=["idAttribute","name","collection","model"];if(r.forEach(function(n){if(!e.hasOwnProperty(n)||!e[n])throw new Error(n+" must be specified when defining a resource")}),n=e.name,i[n])throw new Error(n+" resource has already been defined!");return i[n]=e,o[n]||(o[n]=new e.collection),this},t.createInstance=function(e){return new i[e].model},t.inject=function(e,r,t){var i;return t=_.extend({incomplete:!1},t),i=o[e],t.incomplete&&n(e,r),i.add(r)},t.get=function(e,n){var r,t,c=i[e].idAttribute,u={};return t=o[e],t&&(u[c]=n,r=t.findWhere(u))?r:null},t.getAll=function(e){return o[e]},t.ejectAll=function(e){var n=o[e];n&&n.reset()},t.find=function(e,n){var o,u={},f=i[e].idAttribute,d=this.get(e,n),a=$.Deferred();return d?r(e,n)?d.fetch().then(function(){return delete c[e][n],d}):(a.resolve(d),a.promise()):(u[f]=n,o=new i[e].model(u),o.fetch().then(function(){return t.inject(e,o),o},function(){throw new Error("error fetching model: "+n)}))},t.findAll=function(e){var n=o[e];return n.fetch().then(function(r){return t.inject(e,r),n},function(){throw new Error("error fetching collection: "+e)})},t.where=function(e,n){var r=o[e],t=i[e].collection,c=new t,u=r.where(n);return c.add(u),c},t.reset=function(){return o={},i={},c={},this},e.DS=t,"function"==typeof define&&define.amd&&define(["backbone"],function(){return t})}(window);